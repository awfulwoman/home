- name: Backup Server
  hosts: host-x86-gottakeepswimming
  roles:
    - role: standard_os
    - role: standard-host
    - role: healthchecks
    - role: grub-tune
    - role: zfs-tools
    - role: hifis.unattended_upgrades
      become: true
    - role: motd
    - role: apt-upgrade
  handlers:
    - name: Reboot host
      become: true
      ansible.builtin.reboot:

- name: Home Automation Pi
  hosts: host-pi4-8gb-aprilashley
  roles:
    - role: standard_os
    - role: standard-host
    - role: healthchecks
    - role: cron-reboot
    - role: weareinteractive.environment
      become: true
      no_log: true
    - role: geerlingguy.docker
      become: true
      when: ansible_architecture == "x86_64"
    - role: geerlingguy.docker_arm
      become: true
      when: ansible_architecture == "aarch64"
    - role: docker
    - role: containers-config
    - role: hifis.unattended_upgrades
      become: true
    - role: motd
    # - role: nfs-tools
    # - role: nfs-tools-backup-client
    - role: autorestic
    - role: container-vscode
    - role: container-homeassistant
    - role: container-esphome
    - role: container-mosquitto
    - role: container-zigbee2mqtt # Core Zigbee network
      zigbee_device: /dev/serial/by-id/usb-dresden_elektronik_ingenieurtechnik_GmbH_ConBee_II_DE2467569-if00
    - role: container-zigbee2mqtt # Sandboxed Zigbee network for Aqara/Xiaomi devices
      zigbee_device: /dev/serial/by-id/usb-dresden_elektronik_ingenieurtechnik_GmbH_ConBee_II_DE2652549-if00
      container_name: zigbee2mqtt-aqara
      container_port: 9092
    - role: docker-cleanup
    - role: apt-upgrade
  handlers:
    - name: Reboot host
      become: true
      ansible.builtin.reboot:

- name: Jump Host
  hosts: host-x86-smol
  roles:
    - role: standard_os
    - role: standard-host
    - role: healthchecks
    - role: generate-sshkey
    - role: motd
    - role: weareinteractive.environment
      become: true
      no_log: true
    - role: enable-console-blanking
    - role: geerlingguy.docker
      become: true
    - role: docker
    - role: home
    - role: ansible-password
    - role: containers-config
    - role: geerlingguy.ansible
      become: true
      ansible_install_method: "pip"
    - role: hifis.unattended_upgrades
      become: true
    - role: diodonfrost.terraform
      become: true
    - role: apt-upgrade
  handlers:
    - name: Reboot host
      become: true
      ansible.builtin.reboot:

- name: NAS
  hosts: host-x86-ladyrona
  roles:
    - role: standard_os
    - role: standard-host
    - role: healthchecks
    - role: zfs-tools
    - role: zfs-tools-backup-client
    - role: cron-reboot
    - role: sleepy
    - role: containers-config
    - role: geerlingguy.docker
      become: true
    - role: geerlingguy.docker
      become: true
      when: ansible_architecture == "x86_64"
    - role: geerlingguy.docker_arm
      become: true
      when: ansible_architecture == "aarch64"
    - role: docker
    - role: hifis.unattended_upgrades
      become: true
    - role: host-bus-adapter
    - role: nfs-tools
    - role: nfs-tools-backup-server
    - role: virtualisation-tools
    - role: motd
    - role: container-jellyfin
    - role: container-audiobookshelf
    - role: container-traefik
    - role: container-restic
    - role: container-freshrss
    - role: container-sanoid-builder
    - role: apt-upgrade
    - role: docker-cleanup
  handlers:
    - name: Reboot host
      become: true
      ansible.builtin.reboot:

- name: PiHole DNS + DHCP server
  hosts: pihole
  vars:
    reboot_hour: 2
  roles:
    - role: standard_os
    - role: healthchecks
    - role: weareinteractive.environment
      no_log: true
      become: true
    - role: cron-reboot
    - role: mrlesmithjr.netplan
      become: true
    - role: geerlingguy.docker
      become: true
      when: ansible_architecture == "x86_64"
    - role: geerlingguy.docker_arm
      become: true
      when: ansible_architecture == "aarch64"
    - role: docker
    - role: motd
    - role: hifis.unattended_upgrades
      become: true
    - role: container-pihole
    - role: apt-upgrade
  handlers:
    - name: Reboot host
      become: true
      ansible.builtin.reboot:

- name: Workload containers
  hosts: vm-digitalocean-whalecoiner
  roles:
    - role: standard_os
    - role: standard-host
    - role: generate-sshkey
    - role: healthchecks
    - role: geerlingguy.docker
      become: true
    - role: cron-reboot
    - role: hifis.unattended_upgrades
      become: true
    - role: apt-upgrade
    - role: ip-address-forwarding

  handlers:
    - name: Reboot host
      become: true
      ansible.builtin.reboot:
