---
- name: Home Automation Pi
  hosts: host-pi4-8gb-aprilashley
  roles:
    - role: standard_os
    - role: standard-host
    - role: healthchecks
    - role: cron-reboot
    - role: weareinteractive.environment
      become: true
      no_log: true
    - role: geerlingguy.docker
      become: true
      when: ansible_architecture == "x86_64"
    - role: geerlingguy.docker_arm
      become: true
      when: ansible_architecture == "aarch64"
    - role: docker
    - role: jnv.unattended-upgrades
      become: true
    - role: motd
    # - role: mount-nfs
    - role: udev-rules-zigbee # Create /dev/zigbee-* aliases for Zigbee controllers
    - role: container-vscode
    - role: container-homeassistant
    - role: container-esphome
    - role: container-mosquitto
    - role: container-zigbee2mqtt # Core Zigbee network
      zigbee_device: /dev/zigbee-core
    - role: container-zigbee2mqtt # Sandboxed Zigbee network for Aqara/Xiaomi devices
      zigbee_device: /dev/zigbee-aqara
      container_name: zigbee2mqtt-aqara
      container_port: 9092
    # - role: container-restic
    - role: docker-cleanup
    - role: apt-upgrade
  handlers:
    - name: Reboot host
      become: true
      reboot: