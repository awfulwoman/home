---
- name: Home Automation Server
  hosts: homeautomation
  roles:
    - role: standard_os
    - role: standard-host
    - role: healthchecks
    - role: cron-reboot
    - role: weareinteractive.environment
      become: true
      no_log: true
    - role: artis3n.tailscale
    - role: geerlingguy.docker
      become: true
    - role: docker
    - role: containers-config
    - role: hifis.unattended_upgrades
      become: true
    - role: motd
    - role: ansible-password
    - role: geerlingguy.ansible
      become: true
      ansible_install_method: "pip"
    - role: powertop
    - role: nfs-client
    - role: autorestic
    - role: container-vscode
    - role: container-homeassistant
    - role: container-esphome
    - role: container-mosquitto
    - role: container-heimdall
    - role: container-zigbee2mqtt # Core Zigbee network
    - role: container-zigbee2mqtt-aqara # Sandboxed Zigbee network for Aqara/Xiaomi devices
    - role: container-traefik
    - role: docker-cleanup
    - role: rtl-433
    - role: apt-upgrade
    - role: ansible-pull
    - role: healthchecks-ansible-pull # Always the last

  handlers:
    - name: Reboot host
      become: true
      ansible.builtin.reboot:
