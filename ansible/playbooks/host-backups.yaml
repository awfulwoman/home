---
- name: Backup Server
  hosts: host-backups
  roles:
    - role: standard_os
    - role: standard-host
    - role: healthchecks
    - role: artis3n.tailscale
    - role: grub-tune
    - role: weareinteractive.environment
      become: true
      no_log: true
    - role: generate-sshkey
      become: true
    - role: beep
    - role: zfs-backup-server
    - role: hifis.unattended_upgrades
      become: true
    - role: motd
    - role: apt-upgrade
    - role: beep
    - role: sleepuntil
      sleepuntil_wakeup_script: /usr/local/sbin/zfs-backup.sh
      sleepuntil_sleep_immediately: false
    - role: geerlingguy.ansible
      become: true
      ansible_install_method: "pip" 
    - role: wakeonlan
    - role: ansible-pull
      ansiblepull_install_pull_cron: false

  handlers:
    - name: Reboot host
      become: true
      ansible.builtin.reboot:
