# NOTE:
# There is no config dir here as FreshRSS isn't 
# great at handling user/file permissions. :(
# Instead we must use Docker volumes.

- name: "Create a volume - {{ container_name }}"
  community.docker.docker_volume:
    name: freshrss_data

- name: "Create a volume - {{ container_name }}"
  community.docker.docker_volume:
    name: freshrss_extensions

- name: "Ensure container exists - {{ container_name }}"
  community.docker.docker_container:
    name: "{{ container_name }}"
    image: "{{ container_image }}"
    state: started
    # pull: true
    restart_policy: unless-stopped
    ports:
      - 8082:80
    env:
      TZ: "Berlin/Europe"
      CRON_MIN: "1,31"
    volumes:
      - "freshrss_data:/data:/var/www/FreshRSS/data:rw"
      - "freshrss_extensions:/var/www/FreshRSS/extensions:rw"
      - /etc/localtime:/etc/localtime:ro
    # networks:
#       - name: "affordablepotatoes"
    labels:
      traefik.enable: "true"
      traefik.https.routers.freshrss.rule: "Host(`rss.affordablepotatoes.com`)"
      traefik.https.routers.freshrss.entrypoints: "web"
      traefik.https.services.freshrss.loadbalancer.server.port: "80"
