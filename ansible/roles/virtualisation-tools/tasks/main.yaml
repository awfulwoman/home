---
- name: Install virtualisation tooling
  become: true
  ansible.builtin.apt:
    name: 
      - qemu-kvm
      - libvirt-clients 
      - libvirt-daemon-system
      - bridge-utils 
      - cpu-checker 
      - virtinst 
      - virt-top
    state: present
- name: Add ansible_user to libvirt groups
  become: true
  ansible.builtin.user:
    user: "{{ ansible_user }}"
    groups: 
      - libvirt
      - kvm
    append: true
  notify: Reboot host
- name: Add the vhost_net module
  become: true
  community.general.modprobe:
    name: vhost_net
    state: present
- name: Reset connection to get shell groups
  meta: reset_connection